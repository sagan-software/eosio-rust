<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>eosio-rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="ayu">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="getting-help.html"><strong aria-hidden="true">2.</strong> Getting Help</a></li><li><a href="installation.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li><ol class="section"><li><a href="install-rust.html"><strong aria-hidden="true">3.1.</strong> Install Rust</a></li><li><a href="install-eos.html"><strong aria-hidden="true">3.2.</strong> Install EOS</a></li><li><a href="optional-dependencies.html"><strong aria-hidden="true">3.3.</strong> Optional Dependencies</a></li></ol></li><li><a href="quick-start.html"><strong aria-hidden="true">4.</strong> Quick Start</a></li><li><a href="getting-started.html"><strong aria-hidden="true">5.</strong> Getting Started</a></li><li><a href="examples/index.html"><strong aria-hidden="true">6.</strong> Examples</a></li><li><ol class="section"><li><a href="examples/hello-world.html"><strong aria-hidden="true">6.1.</strong> Hello, World!</a></li><li><a href="examples/tic-tac-toe.html"><strong aria-hidden="true">6.2.</strong> Tic-Tac-Toe</a></li><li><a href="examples/addressbook.html"><strong aria-hidden="true">6.3.</strong> Address Book</a></li><li><a href="examples/url-shortener.html"><strong aria-hidden="true">6.4.</strong> URL Shortener</a></li></ol></li><li><a href="roadmap.html"><strong aria-hidden="true">7.</strong> Roadmap</a></li><li><a href="api-documentation.html"><strong aria-hidden="true">8.</strong> API Documentation</a></li><li><a href="contributing.html"><strong aria-hidden="true">9.</strong> Contributing</a></li><li><ol class="section"><li><a href="contributing/git-commit-messages.html"><strong aria-hidden="true">9.1.</strong> Git Commit Messages</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">eosio-rust</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#introduction" id="introduction"><h1>Introduction</h1></a>
<blockquote>
<p><strong>DISCLAIMER:</strong> <em>This project is in early development and we looking for feedback on all APIs and features. All APIs and features should be considered unstable and insecure until version <code>1.0</code> is released. This code is not yet suitable for production environments where user funds are at risk. Thank you.</em></p>
</blockquote>
<p>This project intends to enable developers to write full-stack EOSIO applications using the Rust programming language. We believe Rust is an excellent choice for EOSIO smart contract development with its focus on safety, speed, and WebAssembly. Furthermore, projects like <a href="https://github.com/rustwasm/wasm-bindgen/">wasm-bindgen</a> and <a href="https://github.com/koute/stdweb/">stdweb</a> make it possible to write full-stack Rust web applications, limiting the need for Javascript and enabling code reuse between browsers, servers, and smart contracts.</p>
<p>The primary goals of this project are to provide Rust crates that:</p>
<ul>
<li>Enable developers to write secure EOSIO smart contracts.</li>
<li>Streamline the development of full-stack EOSIO web applications.</li>
<li>Simplify managing and updating EOSIO table schemas.</li>
<li>Allow developers to publish reusable smart contract code.</li>
</ul>
<a class="header" href="#getting-help" id="getting-help"><h1>Getting Help</h1></a>
<p>If you find a bug or think of an improvement please <a href="https://github.com/sagan-software/eosio-rust/issues/new">open an issue</a> and let us know!</p>
<p>Otherwise if you are stuck on something or run into problems, here are some resources that could help:</p>
<ul>
<li>For questions about this project:
<ul>
<li>[Join our Telegram group][telegram]</li>
<li><a href="https://github.com/sagan-software/eosio-rust/issues/new">Open an issue</a></li>
</ul>
</li>
<li>For questions about EOS development:
<ul>
<li><a href="https://t.me/joinchat/Esi1OkPktgcFeJ3Lmlcrqg">Join the EOS Developers Telegram group</a></li>
<li><a href="https://eosio.stackexchange.com/">Ask on the EOS.IO Stack Exchange</a></li>
<li><a href="https://www.reddit.com/r/eosdev">Ask on r/eosdev</a></li>
</ul>
</li>
<li>For questions about Rust:
<ul>
<li><a href="https://chat.mibbit.com/?server=irc.mozilla.org&amp;channel=%23rust-beginners">Join Mozilla's IRC server</a></li>
<li><a href="https://users.rust-lang.org/">Ask on the Rust user forums</a></li>
<li><a href="https://www.reddit.com/r/rust">Ask on r/rust</a></li>
</ul>
</li>
</ul>
<a class="header" href="#installation" id="installation"><h1>Installation</h1></a>
<p>To write EOS smart contracts in Rust we will need to install Rust and setup an EOS local node.</p>
<a class="header" href="#install-rust" id="install-rust"><h1>Install Rust</h1></a>
<p>Install Rust with <code>rustup</code> per the <a href="https://www.rust-lang.org/en-US/install.html">official instructions</a>:</p>
<pre><code class="language-sh">curl https://sh.rustup.rs -sSf | sh
</code></pre>
<p>This project requires nightly Rust and the <code>wasm32-unknown-unknown</code> target to be available, which can be installed with <code>rustup</code>:</p>
<pre><code class="language-sh">rustup install nightly
rustup target add wasm32-unknown-unknown --toolchain nightly
rustup default nightly
</code></pre>
<a class="header" href="#install-eos" id="install-eos"><h1>Install EOS</h1></a>
<p>An EOS node is required to deploy and test smart contracts. The easiest way to setup a node is to use Docker. See the <a href="https://developers.eos.io/eosio-nodeos/docs/docker-quickstart">official Docker quickstart guide</a> for instructions.</p>
<p>We recommend using <code>docker-compose</code> to manage <code>nodeos</code> and <code>keosd</code> containers. You can download the official <a href="https://raw.githubusercontent.com/EOSIO/eos/master/Docker/docker-compose-latest.yml"><code>docker-compose-latest.yml</code></a> file and start the containers using these commands:</p>
<pre><code class="language-sh">wget https://raw.githubusercontent.com/EOSIO/eos/master/Docker/docker-compose-latest.yml
docker volume create --name=nodeos-data-volume
docker volume create --name=keosd-data-volume
docker-compose -f docker-compose-latest.yml up
</code></pre>
<p><strong>Note #1!</strong> If you are using <code>cleos</code> within a Docker container, you need to mount your project directory as a volume so that <code>cleos</code> can deploy your files. If you're using Docker Compose, add your project directory to the <code>volumes</code> section of the <code>keosd</code> container like so (abbreviated):</p>
<pre><code class="language-yaml">services:
  keosd:
    volumes:
      - ./:mnt/dev/project:ro
</code></pre>
<p><strong>Note #2!</strong> If you are expecting to see console output from <code>nodeos</code> then be sure to add <code>--contracts-console</code> to the end of the <code>nodeosd</code> command like so (abbreviated):</p>
<pre><code class="language-yaml">services:
  nodeosd:
    command: /opt/eosio/bin/nodeosd.sh ... --contracts-console
</code></pre>
<a class="header" href="#optional-dependencies" id="optional-dependencies"><h1>Optional Dependencies</h1></a>
<a class="header" href="#wasm-gc" id="wasm-gc"><h2>wasm-gc</h2></a>
<p><a href="https://github.com/alexcrichton/wasm-gc">wasm-gc</a> is a command-line tool that removes unused code in WASM files. It can be installed with Cargo:</p>
<pre><code class="language-sh">cargo install wasm-gc
</code></pre>
<a class="header" href="#binaryen" id="binaryen"><h2>Binaryen</h2></a>
<p><a href="https://github.com/WebAssembly/binaryen">Binaryen</a> comes with a command-line tool called <code>wasm-opt</code> that optimizes WASM file sizes. Binaryen can be installed with most system package managers.</p>
<a class="header" href="#webassembly-binary-toolkit-wabt" id="webassembly-binary-toolkit-wabt"><h2>WebAssembly Binary Toolkit (WABT)</h2></a>
<p><a href="https://github.com/WebAssembly/wabt">WABT</a> comes with a command-line tool <code>wasm2wat</code> that can be used to create textual representations of WASM files, which can be useful for debugging. WABT can be installed with most system package managers.</p>
<a class="header" href="#quick-start" id="quick-start"><h1>Quick Start</h1></a>
<p>Create the project:</p>
<pre><code class="language-sh">cargo +nightly new hello --lib
cd hello
</code></pre>
<p>File <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies]
eosio = &quot;0.2&quot;

[profile.release]
lto = true
</code></pre>
<p>File <code>.cargo/config</code>:</p>
<pre><code class="language-toml">[target.wasm32-unknown-unknown]
rustflags = [
  &quot;-C&quot;, &quot;link-args=-z stack-size=48000&quot;
]
</code></pre>
<p>File <code>src/lib.rs</code>:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use eosio::*;

#[eosio_action]
fn hi(name: AccountName) {
    eosio_print!(&quot;Hello, &quot;, name);
}

eosio_abi!(hi);
#}</code></pre></pre>
<p>File <code>hello.abi.json</code>:</p>
<pre><code class="language-json">{
    &quot;version&quot;: &quot;eosio::abi/1.0&quot;,
    &quot;structs&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;base&quot;: &quot;&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;name&quot;,
                    &quot;type&quot;: &quot;name&quot;
                }
            ]
        }
    ],
    &quot;actions&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;type&quot;: &quot;hi&quot;
        }
    ]
}
</code></pre>
<p>Compile and minify the smart contract (requires <a href="#optional-dependencies">optional dependencies</a>):</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
</code></pre>
<p>Deploying the smart contract will depend on how you have your EOSIO node setup. Assuming you followed the <code>docker-compose</code> instructions above, run these commands in a terminal:</p>
<pre><code class="language-sh">alias cleos='docker-compose exec keosd cleos --url http://nodeosd:8888 --wallet-url http://127.0.0.1:8900'

# Create a wallet and the 'hello' account
PUBKEY=EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
PRIVKEY=5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3
cleos wallet create --to-console
cleos wallet import --private-key $PRIVKEY
cleos create account eosio hello $PUBKEY $PUBKEY

# Deploy the ABI and WASM files
cleos set abi hello /mnt/dev/project/hello.abi.json
cleos set code hello /mnt/dev/project/hello_gc_opt.wasm

# Say hello
cleos push action hello hi '[&quot;world&quot;]' -p 'hello@active'
</code></pre>
<p>If all went well you should see <code>Hello, world</code> in the console.</p>
<a class="header" href="#getting-started" id="getting-started"><h1>Getting Started</h1></a>
<p>In this section we will walk through writing the <a href="https://github.com/EOSIO/eosio.cdt/tree/master/examples/hello"><code>hello</code> C++ example</a> in Rust. In this example you will learn how to setup and optimize a basic smart contract, accept an input, and print to the console.</p>
<a class="header" href="#creating-the-project" id="creating-the-project"><h4>Creating the project</h4></a>
<p>First, let's create a new project with Cargo and change directories:</p>
<pre><code class="language-sh">cargo +nightly new hello --lib
cd hello
</code></pre>
<p>You should now have a directory that looks like this:</p>
<pre><code>src/
  lib.rs
Cargo.toml
</code></pre>
<a class="header" href="#configuring-cargo" id="configuring-cargo"><h4>Configuring Cargo</h4></a>
<p>The <code>Cargo.toml</code> file is used by Rust to manage dependencies and other configuration options. If you open this file now it should look similar to this:</p>
<pre><code class="language-toml">[package]
name = &quot;hello&quot;
version = &quot;0.1.0&quot;
authors = []
edition = &quot;2018&quot;

[dependencies]
</code></pre>
<p>Let's change this to add <code>eosio</code> as a dependency, and change the crate type so that Rust generates a <code>.wasm</code> file:</p>
<pre><code class="language-toml">[package]
name = &quot;hello&quot;
version = &quot;0.1.0&quot;
authors = []
edition = &quot;2018&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies]
eosio = &quot;0.2&quot;
</code></pre>
<a class="header" href="#generating-and-optimizing-a-wasm-file" id="generating-and-optimizing-a-wasm-file"><h4>Generating and Optimizing a WASM File</h4></a>
<p>At this point we can compile our project to produce a <code>.wasm</code> file:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
</code></pre>
<p>You should now see a generated file at <code>target/wasm32-unknown-unknown/release/hello.wasm</code>:</p>
<pre><code>$ ls -lh target/wasm32-unknown-unknown/release | grep wasm
-rwxr-xr-x 2 sagan sagan 1.9M Oct 25 16:34 hello.wasm
</code></pre>
<p>This file will be huge at almost 2MB! But we can <em>significantly</em> reduce file size by enabling link-time optimization. Add this to the bottom of our <code>Cargo.toml</code> file:</p>
<pre><code class="language-toml">[profile.release]
lto = true
</code></pre>
<p>Now if we rebuild the project we should see a much smaller <code>.wasm</code> file:</p>
<pre><code>$ cargo build --release --target=wasm32-unknown-unknown
$ ls -lh target/wasm32-unknown-unknown/release | grep wasm
-rwxr-xr-x 2 sagan sagan  52K Oct 25 16:48 hello_world.wasm
</code></pre>
<p>That's better, but 52KB is still heavy for an empty smart contract. Luckily we can use <code>wasm-gc</code> and <code>wasm-opt</code> to reduce the file size even further:</p>
<pre><code class="language-sh">wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
</code></pre>
<pre><code>$ ls -lh | grep wasm
-rw-r--r-- 1 sagan sagan  109 Oct 25 16:57 hello_gc_opt.wasm
-rw-r--r-- 1 sagan sagan  116 Oct 25 16:56 hello_gc.wasm
</code></pre>
<p>By using <code>wasm-gc</code> and <code>wasm-opt</code> we are able to get the file size down to just over 100 bytes! But this is before we've added any code. Realistically you can expect simple contracts to be under 15KB.</p>
<a class="header" href="#writing-the-smart-contract" id="writing-the-smart-contract"><h4>Writing the Smart Contract</h4></a>
<p>Now that we know how to prepare the <code>.wasm</code> file, let's start coding. Open up <code>src/lib.rs</code> and replace its contents with this:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use eosio::*;                       // Include everything from the eosio crate

#[eosio_action]                     // Mark this function as an action
fn hi(name: AccountName) {
    eosio_print!(&quot;Hello, &quot;, name);  // Print to the console
}

eosio_abi!(hi);                     // Create the 'apply' function
#}</code></pre></pre>
<p>See the <a href="https://sagan-software.github.io/eosio-rust/">API documentation</a> for more details on what this code is doing.</p>
<p>Let's recompile our project and minify the the WASM file again:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
</code></pre>
<a class="header" href="#creating-the-abi-file" id="creating-the-abi-file"><h4>Creating the ABI File</h4></a>
<p>In the future ABI files will be <a href="#abi-generation">automatically generated</a>, but for now they must be typed out manually. Copy this code into a file called <code>hello.abi.json</code>:</p>
<pre><code class="language-json">{
    &quot;version&quot;: &quot;eosio::abi/1.0&quot;,
    &quot;structs&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;base&quot;: &quot;&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;name&quot;,
                    &quot;type&quot;: &quot;name&quot;
                }
            ]
        }
    ],
    &quot;actions&quot;: [
        {
            &quot;name&quot;: &quot;hi&quot;,
            &quot;type&quot;: &quot;hi&quot;
        }
    ]
}
</code></pre>
<a class="header" href="#deploying-first-attempt" id="deploying-first-attempt"><h4>Deploying, First Attempt</h4></a>
<p>At this point we have our WASM and ABI files, so we're ready to deploy our smart contract.</p>
<p>For this you will need to have access to an EOS node. Please see the <a href="#installing-eos">Installing EOS</a> section for instructions. The code below will assume that you've started <code>nodeos</code> and <code>keosd</code> containers using Docker Compose.</p>
<p>First create an alias for <code>cleos</code>:</p>
<pre><code class="language-sh">alias cleos='docker-compose exec keosd cleos --url http://nodeosd:8888 --wallet-url http://127.0.0.1:8900'
</code></pre>
<p>Then create a wallet, import a private key, and create the <code>hello</code> account:</p>
<pre><code class="language-sh">PUBKEY=EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV
PRIVKEY=5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3
cleos wallet create --to-console
cleos wallet import --private-key $PRIVKEY
cleos create account eosio hello $PUBKEY $PUBKEY
</code></pre>
<p>Deploy the ABI:</p>
<pre><code class="language-sh">cleos set abi hello /mnt/dev/project/hello.abi.json
</code></pre>
<p>Deploy the WASM:</p>
<pre><code class="language-sh">cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
</code></pre>
<p>...but this will <strong>fail</strong> with an error!</p>
<pre><code>$ cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
Reading WASM from /mnt/dev/project/hello_gc_opt.wasm...
Setting Code...
Error 3070002: Runtime Error Processing WASM
</code></pre>
<p>In the <code>nodeos</code> console log you will see this error message:</p>
<pre><code>error 2018-10-26T03:46:12.176 thread-0  http_plugin.cpp:580           handle_exception     ] FC Exception encountered while processing chain.push_transaction
debug 2018-10-26T03:46:12.176 thread-0  http_plugin.cpp:581           handle_exception     ] Exception Details: 3070002 wasm_execution_error: Runtime Error Processing WASM
Smart contract data segments must lie in first 64KiB
     {&quot;k&quot;:64}
     thread-0  wasm_eosio_validation.cpp:30 validate
pending console output:
     {&quot;console&quot;:&quot;&quot;}
     thread-0  apply_context.cpp:72 exec_one
</code></pre>
<p>This is happening because Rust by default reserves 1MB for the stack, but EOS expects data to be <a href="https://github.com/EOSIO/eos/issues/5604">within the first 64KB</a>.</p>
<a class="header" href="#deploying-second-attempt" id="deploying-second-attempt"><h4>Deploying, Second Attempt</h4></a>
<p>We can fix this by telling the Rust compiler to reserve less than 64KB for the stack. Create a new file at <code>.cargo/config</code> with these contents:</p>
<pre><code class="language-toml">[target.wasm32-unknown-unknown]
rustflags = [
  &quot;-C&quot;, &quot;link-args=-z stack-size=48000&quot;
]
</code></pre>
<p>48KB seems to be a reasonable number, but feel free to experiment.</p>
<p>Now let's try to rebuild and redeploy our contract:</p>
<pre><code class="language-sh">cargo build --release --target=wasm32-unknown-unknown
wasm-gc target/wasm32-unknown-unknown/release/hello.wasm hello_gc.wasm
wasm-opt hello_gc.wasm --output hello_gc_opt.wasm -Oz
cleos set code hello /mnt/dev/project/hello_gc_opt.wasm
</code></pre>
<p>Finally, say hello:</p>
<pre><code class="language-sh">cleos push action hello hi '[&quot;world&quot;]' -p 'hello@active'
</code></pre>
<a class="header" href="#success" id="success"><h4>Success!</h4></a>
<p>If all went well you should see <code>Hello, world</code> in the console. Otherwise, if the transaction was sent successfully but you don't see any output, you may need to use the <code>--contract-console</code> option with <code>nodeos</code>.</p>
<a class="header" href="#examples" id="examples"><h1>Examples</h1></a>
<p>Examples can be found in the <a href="examples"><code>examples</code></a> directory. The equivalent C++ code has been provided where possible.</p>
<table><thead><tr><th> Directory                             </th><th> Description                                                            </th></tr></thead><tbody>
<tr><td> <a href="examples/addressbook"><code>addressbook</code></a> </td><td> An example of how to interact with tables using secondary indexes.     </td></tr>
<tr><td> <a href="examples/eosio_token"><code>eosio_token</code></a> </td><td> The standard <code>eosio.token</code> contract ported to Rust.                    </td></tr>
<tr><td> <a href="examples/hello"><code>hello</code></a>             </td><td> The most basic contract using the <code>eosio</code> crate.                       </td></tr>
<tr><td> <a href="examples/hello_bare"><code>hello_bare</code></a>   </td><td> A bare bones version of the <code>hello</code> contract without any dependencies. </td></tr>
<tr><td> <a href="examples/tictactoe"><code>tictactoe</code></a>     </td><td> An example of how to interact with EOSIO tables.                       </td></tr>
</tbody></table>
<a class="header" href="#hello-world" id="hello-world"><h1>Hello, World!</h1></a>
<a class="header" href="#tic-tac-toe" id="tic-tac-toe"><h1>Tic-Tac-Toe</h1></a>
<a class="header" href="#address-book" id="address-book"><h1>Address Book</h1></a>
<a class="header" href="#url-shortener" id="url-shortener"><h1>URL Shortener</h1></a>
<a class="header" href="#roadmap" id="roadmap"><h1>Roadmap</h1></a>
<p><em>See the <a href="https://github.com/sagan-software/eosio-rust/milestone/1">1.0 milestone</a> for a full list of fixes and features planned for 1.0.</em></p>
<p>Listed below are features that are planned for the 1.0 release. The goal is to have a 1.0 release candidate with all these features by Q1 2019, but this may change depending on community feedback and support.</p>
<a class="header" href="#unit-testing" id="unit-testing"><h3>Unit Testing</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/4">issue #4</a></em></p>
<p>A proper test suite is crucial for developers to build secure and correct smart contracts.</p>
<p>EOS already supports unit tests for smart contracts (see <a href="https://github.com/EOSIO/eosio.contracts/tree/master/tests"><code>eosio.contracts</code></a> for an example), so to support this in Rust we will likely need to:</p>
<ol>
<li>Generate more FFI bindings for <a href="https://github.com/EOSIO/eos/tree/master/libraries/chain/">EOS libraries</a>.</li>
<li>Create a new <code>eosio_test</code> crate that will be a test harness, similar to how <a href="https://rustwasm.github.io/wasm-bindgen/wasm-bindgen-test/index.html"><code>wasm-bindgen</code></a> uses <a href="https://github.com/rustwasm/wasm-bindgen/tree/master/crates/test"><code>wasm-bindgen-test</code></a> to support testing in headless browsers.</li>
</ol>
<a class="header" href="#abi-generation" id="abi-generation"><h3>ABI Generation</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/5">issue #5</a></em></p>
<p>Hand-written ABI files are unnecessary and expose developers to risk if they aren't kept updated.</p>
<p>Since we already have <code>#[eosio::action]</code> and <code>#[eosio::table]</code> attributes, it should be fairly straightforward to implement this feature by detecting these attributes and generating a JSON file.</p>
<a class="header" href="#abi-to-rust" id="abi-to-rust"><h3>ABI to Rust</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/6">issue #6</a></em></p>
<p>It would be nice to have a CLI command that would generate Rust code from on-chain ABIs. This would make it significantly easier to interact with external contracts through inline actions.</p>
<p>Implementing this feature would require fetching the ABI JSON from an EOS node and creating a Rust file containing the generated tables and actions.</p>
<a class="header" href="#schema-migrations" id="schema-migrations"><h3>Schema Migrations</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/7">issue #7</a></em></p>
<p>Making changes to EOS table fields is currently not a pleasant experience. It can be a fragile error-prone process that involves duplicating code to work with multiple versions of structs. We believe that a better solution can be found by taking inspiration from projects like <a href="http://diesel.rs/">Diesel</a> and <a href="https://docs.djangoproject.com/en/2.1/topics/migrations/">Django migrations</a>.</p>
<p>Implementing this feature will require significant effort and discovery. This may be a 1.0+ feature.</p>
<a class="header" href="#rpc-api" id="rpc-api"><h3>RPC API</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/8">issue #8</a></em></p>
<p>All EOS apps need a way to talk to EOS nodes, to fetch table rows and to send transactions. In order for full-stack Rust-based EOS applications to come to fruition, there needs to be a solid RPC API. In Javascript there is <code>eosjs</code>, and something similar should exist for Rust.</p>
<p>Implementing this will be tricky since we need to support browser and server environments.</p>
<ul>
<li>For browsers we need to support <a href="https://github.com/rustwasm/wasm-bindgen"><code>wasm-bindgen</code></a> and <a href="https://github.com/koute/stdweb/"><code>stdweb</code></a></li>
<li>For servers we need to support <a href="https://hyper.rs/guides/client/basic/"><code>hyper</code></a></li>
</ul>
<p>This could get even more complicated if we decide to optionally support <a href="https://github.com/rust-lang-nursery/futures-rs">futures</a>. For the initial release futures will probably be mandatory.</p>
<p>There are a lot of things to consider so this may be a 1.0+ feature.</p>
<a class="header" href="#eosio-rust-cli" id="eosio-rust-cli"><h3><code>eosio-rust</code> CLI</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/9">issue #9</a></em></p>
<p>We already have several features that need CLIs. Consolidating all our CLIs under one CLI will make things simpler for developers and allow us to add new commands later on.</p>
<p>Commands should be implemented to:</p>
<ul>
<li>Create a new <code>eosio-rust</code> project, e.g. <code>eosio-rust new</code></li>
<li>Generate an ABI file, e.g. <code>eosio-rust to-abi</code></li>
<li>Generate Rust from an ABI, e.g. <code>eosio-rust from-abi</code></li>
<li>Manage table schemas, e.g. <code>eosio-rust schema</code></li>
<li>Run unit tests, e.g. <code>eosio-rust test</code></li>
</ul>
<a class="header" href="#wasm-bindgen-and-stdweb-support" id="wasm-bindgen-and-stdweb-support"><h3><code>wasm-bindgen</code> and <code>stdweb</code> Support</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/10">issue #10</a></em></p>
<p>A big selling point of Rust is its first-class support for WebAssembly and the possibility of writing full-stack web applications in one highly performant language. It would be great if we could use the same structs and functions from our smart contracts in our frontend code as well.</p>
<p>Implementing this may require rethinking some things, specifically traits that are implemented on primitive types like <code>SecondaryTableKey</code> seem to be causing some issues.</p>
<a class="header" href="#serde-support" id="serde-support"><h3><code>serde</code> Support</h3></a>
<p><em>Tracking this feature in <a href="https://github.com/sagan-software/eosio-rust/issues/11">issue #11</a></em></p>
<p>Serde is the defacto standard when it comes to serializing and deserializing data. It will be necessary for table structs to support Serde's <code>Serialize</code>/<code>Deserialize</code> traits in order to implement the RPC API later on.</p>
<p>Implementing this will require writing custom serializers/deserializers for EOS types, for example:</p>
<ul>
<li>Booleans are 0 or 1</li>
<li>Large numbers can sometimes be integers, sometimes be strings</li>
</ul>
<a class="header" href="#api-documentation" id="api-documentation"><h1>API Documentation</h1></a>
<a class="header" href="#contributing" id="contributing"><h1>Contributing</h1></a>
<a class="header" href="#git-commit-messages" id="git-commit-messages"><h1>Git Commit Messages</h1></a>
<ul>
<li>Use the present tense (&quot;Add feature&quot; not &quot;Added feature&quot;)</li>
<li>Use the imperative mood (&quot;Move cursor to...&quot; not &quot;Moves cursor to...&quot;)</li>
<li>Limit the first line to 72 characters or less</li>
<li>Reference issues and pull requests liberally after the first line</li>
<li>When only changing documentation, include <code>[ci skip]</code> in the commit title</li>
<li>Consider starting the commit message with an applicable emoji:
<ul>
<li>üé® <code>:art:</code> when improving the format/structure of the code</li>
<li>üêé <code>:racehorse:</code> when improving performance</li>
<li>üö± <code>:non-potable_water:</code> when plugging memory leaks</li>
<li>üìù <code>:memo:</code> when writing docs</li>
<li>üêß <code>:penguin:</code> when fixing something on Linux</li>
<li>üçé <code>:apple:</code> when fixing something on macOS</li>
<li>üèÅ <code>:checkered_flag:</code> when fixing something on Windows</li>
<li>üêõ <code>:bug:</code> when fixing a bug</li>
<li>üî• <code>:fire:</code> when removing code or files</li>
<li>üíö <code>:green_heart:</code> when fixing the CI build</li>
<li>‚úÖ <code>:white_check_mark:</code> when adding tests</li>
<li>üîí <code>:lock:</code> when dealing with security</li>
<li>‚¨ÜÔ∏è <code>:arrow_up:</code> when upgrading dependencies</li>
<li>‚¨áÔ∏è <code>:arrow_down:</code> when downgrading dependencies</li>
<li>üëï <code>:shirt:</code> when removing linter warnings</li>
<li>üéâ<code>:tada:</code> when tagging a release</li>
</ul>
</li>
</ul>
<p>Based on https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages</p>
<a class="header" href="#examples-1" id="examples-1"><h4>Examples</h4></a>
<p>Appears under &quot;Features&quot; header, pencil subheader:</p>
<pre><code>feat(pencil): add 'graphiteWidth' option
</code></pre>
<p>Appears under &quot;Bug Fixes&quot; header, graphite subheader, with a link to issue #28:</p>
<pre><code>fix(graphite): stop graphite breaking when width &lt; 0.1

Closes #28
</code></pre>
<p>Appears under &quot;Performance Improvements&quot; header, and under &quot;Breaking Changes&quot; with the breaking change explanation:</p>
<pre><code>perf(pencil): remove graphiteWidth option

BREAKING CHANGE: The graphiteWidth option has been removed. The default graphite width of 10mm is always used for performance reason.
</code></pre>
<p>The following commit and commit <code>667ecc1</code> do not appear in the changelog if they are under the same release. If not, the revert commit appears under the &quot;Reverts&quot; header.</p>
<pre><code>revert: feat(pencil): add 'graphiteWidth' option

This reverts commit 667ecc1654a317a13331b17617d973392f415f02.
</code></pre>
<a class="header" href="#commit-message-format" id="commit-message-format"><h3>Commit Message Format</h3></a>
<p>A commit message consists of a <strong>header</strong>, <strong>body</strong> and <strong>footer</strong>.  The header has a <strong>type</strong>, <strong>scope</strong> and <strong>subject</strong>:</p>
<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
&lt;BLANK LINE&gt;
&lt;body&gt;
&lt;BLANK LINE&gt;
&lt;footer&gt;
</code></pre>
<p>The <strong>header</strong> is mandatory and the <strong>scope</strong> of the header is optional.</p>
<p>Any line of the commit message cannot be longer 100 characters! This allows the message to be easier
to read on GitHub as well as in various git tools.</p>
<a class="header" href="#revert" id="revert"><h3>Revert</h3></a>
<p>If the commit reverts a previous commit, it should begin with <code>revert:</code>, followed by the header of the reverted commit. In the body it should say: <code>This reverts commit &lt;hash&gt;.</code>, where the hash is the SHA of the commit being reverted.</p>
<a class="header" href="#type" id="type"><h3>Type</h3></a>
<p>If the prefix is <code>feat</code>, <code>fix</code> or <code>perf</code>, it will always appear in the changelog.</p>
<p>Other prefixes are up to your discretion. Suggested prefixes are <code>docs</code>, <code>chore</code>, <code>style</code>, <code>refactor</code>, and <code>test</code> for non-changelog related tasks.</p>
<a class="header" href="#scope" id="scope"><h3>Scope</h3></a>
<p>The scope could be anything specifying place of the commit change. For example <code>$location</code>,
<code>$browser</code>, <code>$compile</code>, <code>$rootScope</code>, <code>ngHref</code>, <code>ngClick</code>, <code>ngView</code>, etc...</p>
<a class="header" href="#subject" id="subject"><h3>Subject</h3></a>
<p>The subject contains succinct description of the change:</p>
<ul>
<li>use the imperative, present tense: &quot;change&quot; not &quot;changed&quot; nor &quot;changes&quot;</li>
<li>don't capitalize first letter</li>
<li>no dot (.) at the end</li>
</ul>
<a class="header" href="#body" id="body"><h3>Body</h3></a>
<p>Just as in the <strong>subject</strong>, use the imperative, present tense: &quot;change&quot; not &quot;changed&quot; nor &quot;changes&quot;.
The body should include the motivation for the change and contrast this with previous behavior.</p>
<a class="header" href="#footer" id="footer"><h3>Footer</h3></a>
<p>The footer should contain any information about <strong>Breaking Changes</strong> and is also the place to
reference GitHub issues that this commit <strong>Closes</strong>.</p>
<p><strong>Breaking Changes</strong> should start with the word <code>BREAKING CHANGE:</code> with a space or two newlines. The rest of the commit message is then used for this.</p>
<p>A detailed explanation can be found in this <a href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#">document</a>.</p>
<p>Based on https://github.com/angular/angular.js/blob/master/CONTRIBUTING.md#commit</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
